{% extends "base.html" %}

{% block title %}Transactions - CBS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Transaction Management</h1>
    <button class="btn btn-primary" onclick="toggleForm('transactionForm')">+ New Transaction</button>
</div>

<div id="transactionForm" class="form-box" style="display: none;">
    <h2>New Transaction</h2>
    <form method="POST" action="/transaction/add" id="transForm">
        <div class="form-group">
            <label>Transaction Type</label>
            <select name="type" id="transType" required onchange="toggleTransactionFields()">
                <option value="">Select Type</option>
                <option value="Deposit">Deposit</option>
                <option value="Withdraw">Withdraw</option>
                <option value="Transfer">Transfer</option>
            </select>
        </div>
        
        <div id="singleAccountField" style="display: none;">
            <div class="form-group">
                <label>Account</label>
                <select name="account" id="singleAccount">
                    <option value="">Select Account</option>
                    {% for account in accounts %}
                    <option value="{{ account.AccountNo }}">{{ account.AccountNo }} - {{ account.customer.Name }} (PKR {{ "%.2f"|format(account.Balance) }})</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div id="transferFields" style="display: none;">
            <div class="form-row">
                <div class="form-group">
                    <label>From Account</label>
                    <select name="from_account" id="fromAccount">
                        <option value="">Select Account</option>
                        {% for account in accounts %}
                        <option value="{{ account.AccountNo }}">{{ account.AccountNo }} - {{ account.customer.Name }} (PKR {{ "%.2f"|format(account.Balance) }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>To Account</label>
                    <select name="to_account" id="toAccount">
                        <option value="">Select Account</option>
                        {% for account in accounts %}
                        <option value="{{ account.AccountNo }}">{{ account.AccountNo }} - {{ account.customer.Name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>Amount (PKR)</label>
            <input type="number" name="amount" required placeholder="0.00" step="0.01" min="0.01">
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Process Transaction</button>
            <button type="button" class="btn btn-secondary" onclick="toggleForm('transactionForm')">Cancel</button>
        </div>
    </form>
</div>

<div class="content-box">
    <h2>Transaction History</h2>
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Trans ID</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>From Account</th>
                    <th>To Account</th>
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody>
                {% for trans in transactions %}
                <tr>
                    <td>{{ trans.TransID }}</td>
                    <td><span class="badge badge-{{ trans.Type.lower() }}">{{ trans.Type }}</span></td>
                    <td class="amount">PKR {{ "%.2f"|format(trans.Amount) }}</td>
                    <td>{{ trans.FromAccount or '-' }}</td>
                    <td>{{ trans.ToAccount or '-' }}</td>
                    <td>{{ trans.DateTime.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
